# 🏭 본처리 파이프라인 설계 (Step 3~9)

## 📋 전체 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│  초기 파이프라인 (Step 0~2) - 완료 ✅                              │
│  ├─ Step 0-0: 아이디어 구체화 (GPT+Claude 하이브리드)              │
│  ├─ Step 0-1: 아이디어 확장 (6-12개 주제)                         │
│  ├─ Step 0-2: 주제 스코어링                                       │
│  ├─ Step 1: 플랫폼 추천                                           │
│  ├─ Step 2-1: SERP 크롤링 (30개 블로그)                           │
│  └─ Step 2-2: 30일 콘텐츠 계획                                    │
│                                                                   │
│  출력: initial_pipeline_result.json                               │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  본처리 파이프라인 (Step 3~9) - 신규 구현 🚀                       │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│ Step 3: 문체·톤·스타일 확정 (ToneStyleGeneratorNode)              │
├──────────────────────────────────────────────────────────────────┤
│ 입력: SERP 상위 5~10개 글 + 사용자 선호도                          │
│ 처리:                                                              │
│  ├─ SERP 상위 글 문체 패턴 분석 (Claude Analytical)               │
│  ├─ 장문/단문 스타일 결정                                          │
│  ├─ 템플릿 구조 생성                                               │
│  │   ├─ 오프닝 (개인 경험 1~2문장)                                │
│  │   ├─ 본론 (How to / Case / 리뷰)                              │
│  │   └─ 마무리 (CTA)                                              │
│  └─ 일관성 룰셋 생성                                               │
│                                                                    │
│ 출력: tone_style_guide.json                                        │
│ {                                                                  │
│   "tone": "친근하고 전문적인",                                      │
│   "style": "경험 중심 + 정보 제공",                                 │
│   "structure": {                                                   │
│     "opening": "개인 경험 공감 → 문제 제기",                        │
│     "body": "3단 구성 (How/Case/Review)",                          │
│     "closing": "행동 유도 + 다음 글 예고"                           │
│   },                                                               │
│   "length": "1500~2000자",                                         │
│   "paragraph_rule": "80~140자 단락",                               │
│   "emoji_usage": "섹션별 1개",                                      │
│   "voice": "2인칭 ('당신'이 아닌 '우리')"                           │
│ }                                                                  │
└──────────────────────────────────────────────────────────────────┘
                              ↓
┌──────────────────────────────────────────────────────────────────┐
│ Step 4: SEO 콘텐츠 자동 생성 (SEOContentWriterNode)               │
├──────────────────────────────────────────────────────────────────┤
│ 입력: 30일 계획 + tone_style_guide.json + SERP 컨텍스트            │
│ 처리: (Day 1~30 순회)                                              │
│  ├─ 제목 생성 (48~58자, 키워드 포함)                               │
│  ├─ 서론 작성 (오프닝 템플릿 적용)                                  │
│  ├─ H2/H3 구조 자동 생성 (5~7개 섹션)                              │
│  ├─ 본문 작성                                                      │
│  │   ├─ 80~140자 단락 규칙                                        │
│  │   ├─ 표 1개 자동 삽입 (비교/요약)                               │
│  │   ├─ 리스트 1개 (체크리스트/순서)                               │
│  │   └─ FAQ 3개 (검색 의도 기반)                                  │
│  ├─ 내부 링크 3~5개 (Day 간 연결)                                  │
│  ├─ 수익형 섹션 삽입 (제휴 가능 문장)                               │
│  └─ 마무리 (CTA)                                                   │
│                                                                    │
│ LLM 전략: GPT 구조 생성 + Claude 본문 작성 (하이브리드)            │
│  ├─ GPT: H2/H3 구조, 표/리스트 틀, FAQ 질문 (₩5)                  │
│  └─ Claude: 본문, 오프닝, CTA (₩30)                                │
│                                                                    │
│ 출력: content/day01_content.json ~ day30_content.json              │
│ {                                                                  │
│   "day": 1,                                                        │
│   "title": "[체크리스트] 가족 여행 준비 완벽 가이드",                │
│   "h1": "가족 여행 준비 완벽 체크리스트",                           │
│   "sections": [                                                    │
│     {                                                              │
│       "h2": "여행 전 2주: 필수 준비물",                             │
│       "content": "...",                                            │
│       "h3": ["여권/신분증", "예약 확인", "짐 목록"]                 │
│     }                                                              │
│   ],                                                               │
│   "table": {...},                                                  │
│   "faq": [...]                                                     │
│ }                                                                  │
└──────────────────────────────────────────────────────────────────┘
                              ↓
┌──────────────────────────────────────────────────────────────────┐
│ Step 5: 이미지 자동 생성/선정 (ImagePlannerNode)                   │
├──────────────────────────────────────────────────────────────────┤
│ 입력: day01_content.json ~ day30_content.json                      │
│ 처리: (Day별)                                                      │
│  ├─ 썸네일 + 본문 이미지 3~5개 프롬프트 생성                        │
│  │   예) "4인 가족이 공항에서 즐겁게 준비하는 모습,                 │
│  │        DSLR, 자연광, 따뜻한 색감"                                │
│  ├─ ALT 텍스트 자동 생성 (SEO 최적화)                              │
│  │   예) "가족 여행 준비 체크리스트를 확인하는 엄마와 아이들"        │
│  └─ 파일명 규칙                                                    │
│      예) day01_thumbnail.jpg, day01_section2.jpg                   │
│                                                                    │
│ 이미지 생성 옵션:                                                  │
│  A) DALL-E 3 API (₩40/장, 고품질)                                 │
│  B) Stable Diffusion (무료, 로컬)                                  │
│  C) Unsplash API (무료, 저작권 Free)                               │
│  D) Pexels API (무료, 고품질)                                      │
│                                                                    │
│ 출력: images/day01/thumbnail.jpg, section1.jpg, ...                │
│       image_metadata.json (ALT, 출처, 프롬프트)                     │
└──────────────────────────────────────────────────────────────────┘
                              ↓
┌──────────────────────────────────────────────────────────────────┐
│ Step 6: HTML 템플릿 생성 (HTMLGeneratorNode)                       │
├──────────────────────────────────────────────────────────────────┤
│ 입력: content + images                                             │
│ 처리:                                                              │
│  ├─ 플랫폼별 HTML 변환                                              │
│  │   ├─ 네이버: <span> 기반, inline style                         │
│  │   ├─ 티스토리: <div> + <figure>, clean structure              │
│  │   └─ 워드프레스: Gutenberg blocks                               │
│  ├─ 이미지 삽입 (<img> + alt + lazy loading)                       │
│  ├─ 내부 링크 삽입 (관련 글 3개)                                    │
│  ├─ 표/리스트 HTML 변환                                            │
│  └─ CTA 버튼 삽입                                                  │
│                                                                    │
│ 출력: html/naver/day01.html                                        │
│       html/tistory/day01.html                                      │
│       html/wordpress/day01.html                                    │
└──────────────────────────────────────────────────────────────────┘
                              ↓
┌──────────────────────────────────────────────────────────────────┐
│ Step 7: 메타데이터 생성 (MetaDataGeneratorNode)                    │
├──────────────────────────────────────────────────────────────────┤
│ 입력: content                                                      │
│ 처리:                                                              │
│  ├─ SEO 타이틀 (48~58자, 키워드 앞배치)                            │
│  ├─ 메타 디스크립션 (110~150자, 행동 유도)                         │
│  ├─ 태그 5~10개 (빈도순 + 롱테일)                                  │
│  ├─ 슬러그 생성 (URL 친화적)                                        │
│  └─ OG 이미지 (썸네일)                                             │
│                                                                    │
│ 출력: metadata/day01_meta.json                                     │
│ {                                                                  │
│   "seo_title": "가족 여행 준비 체크리스트 | 4인 가족 완벽 가이드",  │
│   "meta_description": "미취학~중고등학생 자녀와 떠나는...",        │
│   "tags": ["가족여행", "여행준비", "체크리스트", ...],              │
│   "slug": "family-travel-checklist-guide",                         │
│   "og_image": "images/day01/thumbnail.jpg"                         │
│ }                                                                  │
└──────────────────────────────────────────────────────────────────┘
                              ↓
┌──────────────────────────────────────────────────────────────────┐
│ Step 8: 플랫폼 자동 업로드 (PublisherNode)                         │
├──────────────────────────────────────────────────────────────────┤
│ 구현 파일:                                                         │
│  ├─ publishers/naver_publisher.py                                  │
│  ├─ publishers/tistory_publisher.py                                │
│  └─ publishers/wordpress_publisher.py                              │
│                                                                    │
│ 기능:                                                              │
│  ├─ OAuth 로그인 (자동 토큰 갱신)                                  │
│  ├─ 이미지 업로드 → URL 변환                                       │
│  ├─ HTML 업로드                                                    │
│  ├─ 메타데이터 설정 (제목/태그/카테고리)                            │
│  └─ 발행 모드                                                      │
│      ├─ 즉시 발행                                                  │
│      ├─ 임시 저장                                                  │
│      └─ 예약 발행 (날짜/시간)                                      │
│                                                                    │
│ 네이버 블로그 API 제약:                                             │
│  - 공식 API 없음 → Selenium 자동화 필요                            │
│  - 로그인 → 글쓰기 → 이미지 업로드 → 발행                          │
│                                                                    │
│ 티스토리 API:                                                      │
│  - 공식 지원 ✅                                                    │
│  - OAuth 2.0 + REST API                                           │
│  - 문서: https://tistory.github.io/document-tistory-apis/         │
└──────────────────────────────────────────────────────────────────┘
                              ↓
┌──────────────────────────────────────────────────────────────────┐
│ Step 9: 스케줄러 (SchedulerNode)                                   │
├──────────────────────────────────────────────────────────────────┤
│ 구현 옵션:                                                         │
│  A) Python schedule 라이브러리 (간단, 로컬)                        │
│  B) Celery + Redis (고급, 분산)                                    │
│  C) LangGraph Cloud (유료, 완전 자동)                              │
│  D) Make.com / Zapier (노코드)                                     │
│                                                                    │
│ 추천: Python schedule (초기) → Celery (확장)                       │
│                                                                    │
│ 기능:                                                              │
│  ├─ 발행 주기 설정 (1일 1글 / 1주 2회 / 커스텀)                    │
│  ├─ 최적 발행 시간 (평일 오전 10시, 주말 오후 2시)                  │
│  ├─ 실패 시 재시도 (3회)                                           │
│  ├─ 발행 로그 저장                                                 │
│  └─ 알림 (이메일/슬랙)                                             │
│                                                                    │
│ 실행 예:                                                           │
│  python scheduler.py --mode daily --time "10:00"                   │
└──────────────────────────────────────────────────────────────────┘
```

## 💰 비용 분석 (30일 기준)

| 단계 | LLM | 비용/건 | 30일 총액 | 비고 |
|------|-----|---------|-----------|------|
| Step 3 | Claude | ₩50 | ₩50 (1회) | 문체 분석 |
| Step 4 | Hybrid | ₩35 | ₩1,050 | GPT구조+Claude본문 |
| Step 5 | GPT | ₩5 | ₩150 | 이미지 프롬프트 생성 |
| Step 7 | GPT | ₩3 | ₩90 | 메타데이터 |
| **총계** | - | - | **₩1,340** | 이미지 생성 제외 |

**이미지 생성 비용 (선택)**
- DALL-E 3: ₩40/장 × 4장 × 30일 = ₩4,800
- Unsplash/Pexels API: 무료 ✅ (추천)

**전체 비용: ₩1,340 (이미지 무료 옵션 선택 시)**

## ⏱️ 실행 시간 예측

- Step 3: 1회 (2분)
- Step 4: 30초/글 × 30 = 15분
- Step 5: 10초/글 × 30 = 5분 (Unsplash API)
- Step 6: 즉시 (로컬 변환)
- Step 7: 5초/글 × 30 = 2.5분
- Step 8: 30초/글 × 30 = 15분 (네이버 Selenium)
- **총 40분** (완전 자동 30일 블로그 완성)

## 🎯 다음 단계

**즉시 시작: Step 3 문체·톤 확정**
```bash
python nodes/tone_style_generator_node.py
```

입력: `outputs/initial_pipeline_result.json` (SERP 데이터)  
출력: `outputs/tone_style_guide.json`

그 다음:
1. Step 4 SEO 콘텐츠 생성 (30개 글)
2. Step 5 이미지 자동 선정 (Unsplash)
3. Step 6 HTML 변환 (네이버/티스토리)
4. Step 7 메타데이터 생성
5. Step 8 티스토리 자동 업로드 (네이버는 Step 8-B로 분리)
6. Step 9 스케줄러 설정

---

**예상 결과:**
- ✅ 30일치 블로그 글 자동 생성
- ✅ 이미지 포함 완성본
- ✅ 플랫폼별 HTML 자동 변환
- ✅ 1일 1글 자동 발행
- ✅ 총 비용: ₩1,340
- ✅ 총 시간: 40분 (최초 1회)
