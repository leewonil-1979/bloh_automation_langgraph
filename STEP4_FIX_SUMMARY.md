# Step 4 본문 생성 수정 완료

## 문제점
✅ **당신 말이 맞았습니다!** Claude에게 **구체적이고 상세한 지침**을 줘야 합니다.

### 발견된 이슈
1. **JSON 파싱 실패**: Claude가 JSON 문자열 안에 실제 줄바꿈(`\n`)을 포함
   - `Unterminated string starting at: line 89 column 235`
   - Python `json.loads()` 실패
   
2. **섹션 누락**: 6개 섹션 중 1개만 생성됨
   - 프롬프트에 전체 섹션 명시 부족

## 개선 사항

### ✅ 완료된 수정
1. **프롬프트 개선**
   - 모든 6개 섹션을 상세히 나열
   - 각 H3마다 3개 단락 작성 지침 명시
   - 글자 수/문장 수 구체적 제시
   - JSON 줄바꿈 금지 명시

2. **JSON 파싱 강화**
   - 정규식으로 문자열 값 내 제어 문자 제거
   - 마크다운 코드 블록 처리
   - 디버깅 로그 추가

### ⚠️ 남은 문제
**Claude가 지침을 무시하고 계속 줄바꿈 포함**
- 5번 시도 모두 동일한 `Unterminated string` 에러
- 정규식 파싱도 실패 (불완전한 JSON 생성)

## 다음 단계 제안

### 방법 1: JSON 대신 XML/YAML 사용
```xml
<content>
  <opening>텍스트...</opening>
  <section>
    <h2>제목</h2>
    <h3>소제목</h3>
    <paragraph>단락1</paragraph>
  </section>
</content>
```
- Claude가 XML은 더 잘 생성함
- 파싱도 안정적

### 방법 2: 단계별 생성
1단계: 오프닝만 생성
2단계: 섹션 1-2 생성
3단계: 섹션 3-4 생성
4단계: 섹션 5-6 + FAQ + 마무리 생성
→ 작은 JSON은 파싱 성공률 높음

### 방법 3: GPT로 전환
- Claude: 창의적이지만 JSON 불안정
- GPT-4o: JSON 모드 지원, 안정적
- 단, 비용 약간 증가 (₩35 → ₩40)

### 방법 4: 구조화된 프롬프트 with Few-shot
실제 완성된 JSON 예시 3개를 프롬프트에 포함
→ Claude가 패턴 학습

## 권장 방법

**즉시 해결**: **방법 3 (GPT로 전환)**
- 가장 확실한 해결책
- `json_mode=True` 사용 시 100% 유효한 JSON
- 비용 차이 미미 (₩5 추가)

**장기적**: **방법 1 (XML) + 방법 4 (Few-shot)**
- Claude 품질 유지
- 안정적 파싱

## 사용자 결정 필요

어떤 방법으로 진행할까요?
1. GPT로 본문 생성 변경 (빠르고 확실)
2. XML 형식으로 변경 (Claude 유지)
3. 단계별 생성 (현재 방식 유지, 안정성 개선)
4. Few-shot 예시 추가 (한 번 더 시도)
